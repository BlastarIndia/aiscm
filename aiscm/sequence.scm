(define-module (aiscm sequence)
  #:use-module (aiscm element)
  #:use-module (aiscm malloc)
  #:use-module (aiscm pointer)
  #:use-module (aiscm lookup)
  #:use-module (aiscm lambda)
  #:use-module (aiscm var)
  #:use-module (oop goops)
  #:export (make-sequence
            sequence->list))
(define (make-sequence type size)
  (let* ((mem (make-malloc (* (storage-size type) size)))
         (ptr (make-pointer type mem))
         (var (make-var))
         (lookup (make-lookup ptr var 1)))
    (make-lambda lookup var size)))
(define (sequence->list seq)
  (let ((n (get-length seq)))
    (if (> n 0)
      (cons (get seq 0) (sequence->list (slice seq 1 (- n 1))))
      '())))
(define-method (write (self <lambda>) port)
  (format port "#<sequence~a>:~&~a"
          (class-name (typecode self))
          (sequence->list self)))
(define-method (display (self <lambda>) port)
  (format port "#<sequence~a>:~&~a"
          (class-name (typecode self))
          (sequence->list self)))
